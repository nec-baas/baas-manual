.. include:: ../common/linkdef.rst

===================
はじめに
===================

本文書は、モバイルバックエンド基盤 イベント駆動の開発ガイドです。

本文書では、イベント駆動の開発方法・
実行方法について解説します。

イベント駆動とは
=====================

モバイルバックエンド基盤 イベント駆動は、モバイルバックエンド基盤サーバ上で発生した各種のイベントを契機にして、クラウドファンクションを起動する機能です。
以下3つのサブ機能から成り立っています。

イベント検知
-------------------------

モバイルバックエンド基盤内で発生したイベントを検知する機能です。

以下の2種類のイベントを検知できます。

- ファイルストレージイベント
- スケジューライベント

イベントフィルタリング
------------------------

検知したイベントをフィルタリングする機能です。

イベントハンドリング
----------------------

イベントを処理する機能です。

検知・フィルタリングしたイベントをクラウドファンクション機能にて処理できます。

イベント駆動の利用方法
=======================

下記2点をモバイルバックエンド基盤サーバに登録することで、イベント駆動を利用できます。

- イベントサブスクリプション
- イベント処理用クラウドファンクション

用語の定義
==========

本マニュアルでは以下の用語定義を使用します。

* イベント: モバイルバックエンド基盤内で発生した事象を、JSON形式で表現・通知するもの。
* イベントサブスクリプション: ユーザが設定する、イベント検知・フィルタリング・ハンドリングという、イベント駆動の一連の流れ。JSON形式・YAML形式で定義する。

動作環境
========

イベント駆動の開発には、イベントハンドラを作成するために、クライアント側にクラウドファンクションの開発環境が必要です。

* `NEC BaaS Cloud Functions Developer Guide <../cloudfunctions/index.html>`_

イベント駆動の動作には、以下のサーバが必要になります。

* `モバイルバックエンド基盤サーバ <../../../server/ja/server/index.html>`_
* `Cloud Functionsサーバ <../../../server/ja/cloudfunctions-server/index.html>`_

.. note::

  イベント駆動を利用する際には、モバイルバックエンド基盤サーバのDBとして、MongoDB 3.6以降が必須です。

.. note::
  MongoDB サーバのレプリカセットを有効にする必要があります。
  これは、イベント駆動機能が、内部的に MongoDB の Change Streams 機能に依存しているためです。
  詳細は、MongoDB のマニュアル `Change Streams <https://docs.mongodb.com/manual/changeStreams/>`_ を参照してください。
  なお、MongoDBサーバが１台構成であっても、レプリカセットを有効にすることは可能です。

.. note::

  MongoDBをシャーディング有効で動作させている場合、イベント駆動は利用できません。
