.. index::
   single: アカウントリンク

.. _account_link:

=======================================
アカウントリンク情報の設定、取得、削除
=======================================

アカウントリンク情報の設定
===========================

アカウントリンク情報の設定とは、BaaS サーバに作成済のローカルユーザやOIDC認証ユーザに他の外部サービスの
アカウント (OPアカウント)でもログインできるよう、認証方法をリンク設定することです。
複数のOPアカウントを同一ユーザとして管理することが可能となります。

例えば、Google とのOIDC認証により作成されたユーザが ADFSアカウントとのリンク設定を行うと、
以降、 Google に加えて ADFS とのOIDC認証を使用してログインすることが可能となります。

具体的には、リンクさせたいユーザでログイン後、クエリパラメータ sessionToken にセッショントークンを指定して、
OpenID Connect 認証開始 API を実行します。
なお、認証に使用されたOPアカウントが既に別ユーザでリンク設定されている場合は、リンクエラーとなります。

.. attention::

   ローカルユーザにアカウントリンク設定した場合、外部認証連携ユーザの扱いとなります。そのため、ユーザ削除やユーザ情報変更時などに403エラーが返却されるようになります。ローカルユーザに戻す場合は、アカウントリンク情報を削除してください。
   詳細は、:ref:`del_account_link` を参照してください。

アカウントリンク情報の取得
===========================

OpenID Connectリンク情報取得 API を使用します。

詳細は `JavaScript SDK マニュアル の「ユーザ管理 - OpenID Connectリンク情報取得」 <../../javascript/user.html#js-getlinks>`_ を参照してください。

.. _del_account_link:

アカウントリンク情報の削除
============================

OpenID Connectリンク情報削除 API を使用します。

詳細は `JavaScript SDK マニュアル の「ユーザ管理 - OpenID Connectリンク情報削除」 <../../javascript/user.html#js-dellink>`_ を参照してください。

primaryLinkedUserId に設定されているリンクユーザIDは削除できません。

リンク情報削除に成功した場合は、該当ユーザの以下の情報が更新されます。

* オプション情報: 該当リンクのclaim情報を削除
* 外部認証連携有無: 全てのリンクが削除された場合にfalseを設定
