

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.5. ファイルストレージ &mdash; Developer Manual 7.0.0 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="2.6. セキュリティ : ACL" href="acl.html" />
    <link rel="prev" title="2.4. オブジェクトストレージ" href="object_storage.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Developer Manual
          

          
          </a>

          
            
            
              <div class="version">
                7.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. イントロダクション</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. 機能ガイド</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="application.html">2.1. テナントとアプリケーション</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_management.html">2.2. ユーザ管理・認証機能</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_management.html">2.3. グループ管理機能</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_storage.html">2.4. オブジェクトストレージ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.5. ファイルストレージ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">2.5.1. ファイルストレージの概要</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">2.5.2. ファイルストレージのバックエンド</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">2.5.3. ファイルバケット</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">2.5.4. ファイル</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">2.5.5. ファイル操作API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.5.6. ファイルの公開</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">2.5.7. ファイルの同時アクセスの排他制御</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="acl.html">2.6. セキュリティ : ACL</a></li>
<li class="toctree-l2"><a class="reference internal" href="cors.html">2.7. Cross Origin Resource Sharing (CORS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="object_offline.html">2.8. オフライン機能</a></li>
<li class="toctree-l2"><a class="reference internal" href="push.html">2.9. Push通知</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../limits.html">3. 制限値・スレショルド・文字制約</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">2. 機能ガイド</a> &raquo;</li>
        
      <li>2.5. ファイルストレージ</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>2.5. ファイルストレージ<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="id2">
<h2>2.5.1. ファイルストレージの概要<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファイルストレージは、バイナリ形式でのファイルを保存、読み出しすることができるストレージ機能です。</p>
<p>アップロードできるファイルサイズの上限はデベロッパーコンソールにより、設定可能です。
詳細は <a class="reference external" href="../../devconsole/index.html">デベロッパーコンソール利用ガイド</a> の「システム設定 - ファイルストレージ設定」を参照ください。</p>
<p>ファイルは、オブジェクトストレージと同様にバケット単位で管理することができます。
アクセス制限をファイル単位で設定することが可能です。</p>
<img alt="../_images/file_storage.png" src="../_images/file_storage.png" />
<p>また、ファイルは「公開」を行うことができます。公開を行うと、そのファイルには認証なしでアクセスすることが
できるようになります。</p>
<p>さらに、ファイルの同時アクセスの排他制御を対応するため、複数ユーザから、同一ファイルの読み書きを行っても、
ファイルの不整合が生じません。</p>
</div>
<div class="section" id="id4">
<h2>2.5.2. ファイルストレージのバックエンド<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファイルを格納するバックエンドとしては、以下のいずれかを使用できます。</p>
<ul class="simple">
<li>MongoDB</li>
<li>S3互換オブジェクトストレージ</li>
</ul>
<p>デフォルトでは MongoDB 内にファイルが格納されます。これは MongoDB の GridFS という
機能を使用しています。</p>
<p>これとは別に S3互換オブジェクトストレージにファイルを格納することもできます。
テナント単位・もしくはファイルバケット単位で格納先となるS3互換オブジェクトストレージを
設定することで利用可能となります。
詳細は <a class="reference external" href="../../devconsole/index.html">デベロッパーコンソール利用ガイド</a> の「テナント設定 - 外部ストレージ設定」を参照ください。</p>
</div>
<div class="section" id="id6">
<h2>2.5.3. ファイルバケット<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>オブジェクトストレージと同様、ファイルを格納する入れ物として「ファイルバケット」があります。</p>
<p>ファイルバケットには任意の名前を付けることができます。また、バケット内に格納できるファイル数には
上限はありませんが、諸元として保証しているファイル数の上限は1テナントあたり1,000個です。
さらに、ファイルの種類についても制限はありませんが、管理上は用途別に個別にバケットを作成することをおすすめします。</p>
</div>
<div class="section" id="id7">
<h2>2.5.4. ファイル<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>バケット内のファイルは、「ファイル名」で一意に識別します。
１つのバケット内には、同名のファイルを２つ以上格納することはできません。</p>
<p>ファイルは、メタデータと本体の２つで管理します。</p>
<p>メタデータは以下のように JSON 形式で表現します。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;533d31c43cbc3dd2d0b32cd1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;filename&quot;</span><span class="o">:</span> <span class="s2">&quot;hello.txt&quot;</span><span class="p">,</span>
  <span class="s2">&quot;contentType&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="s2">&quot;length&quot;</span><span class="o">:</span> <span class="mi">12039</span><span class="p">,</span>
  <span class="s2">&quot;ACL&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;owner&quot;</span><span class="o">:</span> <span class="s2">&quot;01234567890&quot;</span><span class="p">,</span>
    <span class="s2">&quot;r&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;g:authenticated&quot;</span><span class="p">],</span>
    <span class="s2">&quot;w&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;g:authenticated&quot;</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="s2">&quot;publicUrl&quot;</span><span class="o">:</span> <span class="s2">&quot;https://xxxxxxx/hello.txt&quot;</span><span class="p">,</span>
  <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-08-27T04:37:30.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-08-27T04:37:30.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;metaETag&quot;</span><span class="o">:</span> <span class="s2">&quot;9d4a7501-9ccc-4685-bff8-7b2933063f8f&quot;</span><span class="p">,</span>
  <span class="s2">&quot;fileETag&quot;</span><span class="o">:</span> <span class="s2">&quot;b7c29998-310a-4a61-921f-44438261691c&quot;</span><span class="p">,</span>
  <span class="s2">&quot;cacheDisabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="s2">&quot;options&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;owner&quot;</span><span class="o">:</span> <span class="s2">&quot;日電　太郎&quot;</span><span class="p">,</span>
    <span class="s2">&quot;file_version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>_id : ファイルのメタデータのオブジェクトIDです。</li>
<li>filename : ファイルの名前です。バケット内には同一のファイル名のファイルは１つのみしか入れられません。</li>
<li>contentType : ファイルのコンテンツタイプです。</li>
<li>length : ファイルのバイト数です。これはファイル本体をアップロードすると、自動で設定されます。</li>
<li>ACL : ファイルの ACL です。</li>
<li>createdAt : ファイルを作成した日付です。最初にアップロードした日付になります。</li>
<li>updatedAt : ファイルを最後に更新した日付です。</li>
<li>publicUrl : 公開ファイルをアクセスするためのURLです（なお、公開ファイルのみ存在）。</li>
<li>metaETag  : ファイルのメタデータのETagです。</li>
<li>fileETag  : ファイル本体のETagです。</li>
<li>cacheDisabled : キャッシュ禁止フラグです（ファイルストレージのオフライン機能で利用。現時点では未対応）。</li>
<li>options: ユーザ定義メタ情報</li>
</ul>
</div>
<div class="section" id="api">
<h2>2.5.5. ファイル操作API<a class="headerlink" href="#api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファイルを操作するための API として、各SDKでは以下のものを提供しています。</p>
<ul class="simple">
<li>ファイルの新規アップロード : メタデータと本体を同時に登録します。</li>
<li>ファイルの更新アップロード : 本体のみを差し替えます。</li>
<li>ファイルのダウンロード : 本体をダウンロードします。</li>
<li>ファイルの削除 : メタデータと本体を削除します。</li>
<li>検索 : バケットに含まれるメタデータ一覧を取得します。</li>
<li>メタデータの更新 : メタデータのみを更新します。</li>
<li>ファイルの公開：ファイルを認証なしでダウンロードできる一意な URLを作成します。</li>
<li>ファイルの公開解除：ファイルの公開で作成したURLを削除します。</li>
</ul>
</div>
<div class="section" id="id8">
<h2>2.5.6. ファイルの公開<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファイルの公開および公開解除用の API を提供しています。</p>
<p>ファイルを公開すると、ファイル対して一意な URL が割り当てられます。
この URL には認証なしでアクセスすることができますので、HTML の a タグや img タグで
直接ファイルにアクセスさせることができるようになります。</p>
<a class="reference internal image-reference" href="../_images/file_storage_public.png"><img alt="../_images/file_storage_public.png" src="../_images/file_storage_public.png" style="width: 576.0px; height: 432.0px;" /></a>
</div>
<div class="section" id="id9">
<h2>2.5.7. ファイルの同時アクセスの排他制御<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ファイルの同時アクセスの排他制御を対応しています。</p>
<p>一般的な排他ポリシーとして、ファイルへのアクセス種別(read/write)によらず、同じファイルに対して同時アクセスを全て拒否する排他制御があります。しかし実用上、あるファイルのダウンロード中に、そのファイルを更新することはよくあるので、ダウンロード中にファイルの更新を全て拒否すると、ユーザに対する利便性が損なわれます。</p>
<p>そこで NEC BaaS では、以下のような同時アクセスの排他制御のポリシーを採用しました。</p>
<ul class="simple">
<li>ファイルのダウンロード中に、同じファイルに対してのダウンロード、更新、削除は許可しますが、新規作成は拒否します。<ul>
<li>※１ ファイルの更新前後で、そのファイルを別扱いとします。変更前のファイルに対するファイルのダウンロードは最後まで完了できます。サーバ内部処理として、更新完了後にファイル本体の差し替えを行います。</li>
<li>※２ ファイルの削除も更新と同様に、実行中のファイルのダウンロードが最後まで完了できます。なお、ファイルの削除ではまず論理的削除が実行され、一定期間（24時間）経過後、自動的に物理削除されます。</li>
</ul>
</li>
<li>ファイルのダウンロード中、更新中、あるいは、削除中に、同じファイルに対するアクセス(ダウンロード、更新、削除、新規作成)は全て拒否します。</li>
</ul>
<a class="reference internal image-reference" href="../_images/file_exclusive_control.png"><img alt="../_images/file_exclusive_control.png" src="../_images/file_exclusive_control.png" style="width: 640.8px; height: 321.6px;" /></a>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="acl.html" class="btn btn-neutral float-right" title="2.6. セキュリティ : ACL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="object_storage.html" class="btn btn-neutral" title="2.4. オブジェクトストレージ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2018, NEC Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'7.0.0',
            LANGUAGE:'ja',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-116465316-2"></script>
      <script type="text/javascript" src="../_static/analytics.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>