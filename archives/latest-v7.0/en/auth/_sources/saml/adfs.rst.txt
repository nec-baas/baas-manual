ADFS
====

Windows Server2012 R2上での操作を例に説明します。

IdPメタデータのダウンロード
----------------------------

ADFS サーバ (Windows Server 2012 R2) の場合は、下記 URL から取得できます。

  <https://<servername>/FederationMetadata/2007-06/FederationMetadata.xml>

このファイルを BaaS デベロッパーコンソールから IdPメタデータとしてアップロードしてください。

SPメタデータの登録と設定
--------------------------

1) サーバーマネージャ＞ダッシュボード＞ツール＞ AD FSの管理を選択
2) ADFS 画面左の ADFS > 信頼関係 配下を展開して表示
3) 証明書利用者信頼を右クリックして「証明書利用者信頼の追加」を選択
4) 証明書利用者信頼の追加ウィザードを開始
5) 「証明書利用者についてのデータをファイルからインポートする」を選び、参照ボタン押下でエクスポートした SP メタデータファイルを選択
6) 追加ウィザードに従い次に進む。この際、表示名には適当な文字列を選択し、デフォルトの設定を変更せずに次に進む
7) 完了画面で、ウィザードの終了時にこの証明書利用者信頼の「要求規則の編集」ダイアログを開く、にチェックがついていることを確認して閉じるを選択
8) 要求規則の編集画面が起動されるので、以下の規則を追加

.. list-table:: 
   :widths: 10 7 9 12 10

   * - 要求規則テンプレート
     - 要求規則名
     - 属性ストア
     - LDAP属性
     - 出力方向の要求の種類の種類
   * - LDAP属性を要求として送信
     - 任意の規則名
     - Active Directory
     - SAM-Account-Name
     - 名前ID
   * - LDAP属性を要求として送信
     - 任意の規則名
     - Active Directory
     - Token-Groups-名前の指定なし
     - グループ
   * - LDAP属性を要求として送信
     - 任意の規則名
     - Active Directory
     - SAM-Account-Name
     - 共通名

9) OK ボタンで要求規則の編集画面を閉じる
10) 登録したデータの表示名を右クリック＞プロパティ＞詳細設定タブでセキュアハッシュアルゴリズムを SHA-1 に設定

