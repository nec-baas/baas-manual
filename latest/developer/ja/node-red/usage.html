

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. 利用方法 &mdash; Node-RED User Guide 7.5.0 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="4. 利用パターン" href="patterns.html" />
    <link rel="prev" title="2. 開発環境のセットアップ" href="dev_setting.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Node-RED User Guide
          

          
          </a>

          
            
            
              <div class="version">
                7.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_setting.html">2. 開発環境のセットアップ</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. 利用方法</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nec-baas">3.1. NEC BaaS ノードの利用方法</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id21">3.1.1. 認証ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">3.1.2. ユーザ取得ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">3.1.3. オブジェクトデータ保存ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">3.1.4. オブジェクトデータ取得ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function">3.1.5. Function ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push">3.1.6. Push 送信ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">3.1.7. Push 受信ノード</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-gw">3.1.8. API-GW ノード</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id33">3.2. 補足事項</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id34">3.2.1. NEC BaaS ライブラリの使用</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">4. 利用パターン</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_setting.html">5. 公開サーバのセットアップ</a></li>
<li class="toctree-l1"><a class="reference internal" href="enebular.html">6. Enebular での利用方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">7. マイグレーションガイド</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Node-RED User Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>3. 利用方法</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>3. 利用方法<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="nec-baas">
<h2>3.1. NEC BaaS ノードの利用方法<a class="headerlink" href="#nec-baas" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>NEC BaaS ノードを Node-RED の Flow エディタ画面上に配置後、ノード内の設定ダイアログで動作に必要な情報を設定する必要があります。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">各設定値は設定ダイアログを使用せず、上流からノードへの <strong>入力メッセージ</strong> ( msg.payload 等)として指定できるものがあります。ノードの設定ダイアログと入力メッセージで同じ値を重複して指定した場合、後者の入力メッセージの値が優先されます。詳細は Node-RED ブラウザの右上に表示される各ノードの info タブを参照してください。</p>
</div>
<div class="section" id="id21">
<h3>3.1.1. 認証ノード<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS への <a class="reference external" href="../developer/functions/user_management.html">認証(パスワード認証/クライアント証明書認証)</a> に使用するノードです。
認証ノード(auth)の設定ダイアログを開き、以下を設定してください。</p>
<ul class="simple">
<li>パスワード認証を行う場合は、 <strong>Action</strong> 欄で <strong>login</strong> を選択してください。</li>
<li>パスワード認証に必要なアカウント情報を <strong>Email</strong>　(または <strong>User</strong>), <strong>Password</strong> 欄に入力してください。</li>
</ul>
<a class="reference internal image-reference" href="_images/login_dialog.png"><img alt="_images/login_dialog.png" src="_images/login_dialog.png" style="width: 328.0px; height: 275.2px;" /></a>
<ul class="simple">
<li>クライアント証明書認証を行う場合は、 <strong>Action</strong> 欄で <strong>Use Client Cert authentication</strong> を選択してください。</li>
<li>クライアント証明書認証に使用する証明書形式を選択後、使用する証明書情報を指定してください。その際、証明書ファイルの絶対パスを <strong>Filename</strong> 欄に入力してください。</li>
</ul>
<a class="reference internal image-reference" href="_images/login_cert.png"><img alt="_images/login_cert.png" src="_images/login_cert.png" style="width: 329.6px; height: 331.20000000000005px;" /></a>
<ul class="simple">
<li><strong>Initialize?</strong> をチェック後、接続先の NEC BaaS サーバ 情報を <strong>Config</strong> 欄に設定してください。 Base URI は必ず末尾を <strong>/api</strong> としてください。</li>
</ul>
<a class="reference internal image-reference" href="_images/login_config.png"><img alt="_images/login_config.png" src="_images/login_config.png" style="width: 328.8px; height: 222.4px;" /></a>
<div class="admonition attention">
<p class="first admonition-title">注意</p>
<p class="last"><strong>Initialize?</strong> のチェックを有効にするノードは、 必ず Flow 画面(タブ)内で1つとしてください。接続先として異なるテナント/アプリを使用したい場合は、異なる Flow 画面(タブ)上に本ノードを配置し、 Config欄で <strong>「新規にnebula-serverを追加...」</strong> を選択して追加設定してください。 <strong>「新規にnebula-serverを追加...」</strong> 以外を選択した場合、追加ではなく更新設定になるためご注意ください。</p>
</div>
</div>
<div class="section" id="id23">
<h3>3.1.2. ユーザ取得ノード<a class="headerlink" href="#id23" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS に登録された <a class="reference external" href="../javascript/user.html#id4">ユーザ情報を取得</a> するノードです。
ユーザ取得ノード(user)の設定ダイアログを開き、以下を設定してください。</p>
<ul class="simple">
<li><strong>Action</strong> 欄で操作を選択してください。</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">操作</th>
<th class="head">Action 欄</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ログイン中のユーザ取得</td>
<td>Get the current user</td>
</tr>
<tr class="row-odd"><td>ユーザIDによるユーザ取得</td>
<td>Get the user by ID</td>
</tr>
<tr class="row-even"><td>全てのユーザを取得</td>
<td>Get all users</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id25">
<h3>3.1.3. オブジェクトデータ保存ノード<a class="headerlink" href="#id25" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS のオブジェクトストレージに対して <a class="reference external" href="../developer/functions/object_storage.html">データ保存や削除</a> を行うノードです。
データ保存ノード(object)の設定ダイアログを開き、以下を設定してください。</p>
<ul class="simple">
<li><strong>Bucket Name</strong> 欄に バケット名を入力してください。</li>
<li><strong>Action</strong> 欄で操作を選択してください。</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">操作</th>
<th class="head">Action 欄</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>オブジェクトの保存</td>
<td>Save the object</td>
</tr>
<tr class="row-odd"><td>オブジェクトの削除</td>
<td>Delete the object</td>
</tr>
<tr class="row-even"><td>オブジェクトの全削除</td>
<td>Delete all objects</td>
</tr>
<tr class="row-odd"><td>バケットの削除</td>
<td>Delete the bucket (注1)</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>注1) バケットの削除を行う場合は、認証ノード Config 内の App Key 欄に <a class="reference external" href="../rest/intro.html#id-id">マスターキー</a> を設定する必要があります。</li>
</ul>
</div>
<div class="section" id="id28">
<h3>3.1.4. オブジェクトデータ取得ノード<a class="headerlink" href="#id28" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS のオブジェクトストレージから <a class="reference external" href="../developer/functions/object_storage.html">データを取得</a> するノードです。
データ取得ノード(object)の設定ダイアログを開き、以下を設定してください。</p>
<ul class="simple">
<li><strong>Bucket Name</strong> 欄にバケット名を入力してください。</li>
<li>全てのオブジェクトデータを取得する場合は、 <strong>Use Search conditions?</strong> のチェックを無効にしてください。</li>
<li>検索条件を指定する場合は、 <strong>Use Search conditions?</strong> のチェックを有効にして条件式を入力してください。条件式は 5 項目まで作成でき、 OR/AND 条件のいずれかを指定できます。</li>
</ul>
<a class="reference internal image-reference" href="_images/object_in_condition.png"><img alt="_images/object_in_condition.png" src="_images/object_in_condition.png" style="width: 324.0px; height: 144.8px;" /></a>
<div class="admonition attention">
<p class="first admonition-title">注意</p>
<p class="last">検索条件で指定する値は、上記の赤円部分で値の型(文字列/数字等)を選択できます。例えば、上記のキー age に対して値の型を文字列とした場合は &quot;30&quot;、数字とした場合は 30 として扱われます。</p>
</div>
<ul class="simple">
<li><strong>Sort</strong> 欄では、指定したキーに対して昇順/降順を指定できます。</li>
<li><strong>Skip Count</strong> 欄では、指定した件数以降のオブジェクトデータを取得します。</li>
<li><strong>Upper Limit</strong> 欄では、取得するオブジェクトデータの上限数を指定します。<ul>
<li>上限数の値はデフォルトで 100 となっています。 上限数を無限大(制限なし)にしたい場合は -1 を指定します。</li>
</ul>
</li>
<li><strong>Projection</strong> 欄では、取得したオブジェクトに含まれるフィールドを指定します。<ul>
<li>例えば、{&quot;name&quot;:1} とした場合は、 取得したオブジェクトに name のフィールドのみ含まれます。</li>
<li>Projection 欄では、フィールドの表示/非表示が混在する指定はできません。例えば、 {&quot;name&quot;:1, &quot;age&quot;:1}　のような指定はできますが、 {&quot;name&quot;:1, &quot;age&quot;:0} のような指定はエラーとなります。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="function">
<h3>3.1.5. Function ノード<a class="headerlink" href="#function" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS が提供する様々な機能へのアクセス手段を JavaScript で実装できるノードです。
<strong>Function</strong> 欄 に 実行するスクリプトを記述することで、他 NEC BaaS ノードでは対応できない複雑なロジック等を実装することができます。</p>
<div class="admonition attention">
<p class="first admonition-title">注意</p>
<p class="last"><strong>Initialize?</strong> の設定方法は認証ノードと同じです。認証ノードと同じく、 <strong>Initialize?</strong> のチェックを有効にするノードは 必ず Flow 画面(タブ)内で1つとしてください。</p>
</div>
<p>前述のデータ保存ノードと同様の機能を Function ノードで実装する場合は、
以下のスクリプトを記述します。
上流ノードから来た msg の payload をそのままバケットに書き込む例です。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>var <span class="nv">Nebula</span> <span class="o">=</span> flow.get<span class="o">(</span><span class="s1">&#39;Nebula&#39;</span><span class="o">)</span><span class="p">;</span>
var <span class="nv">bucket</span> <span class="o">=</span> new Nebula.ObjectBucket<span class="o">(</span><span class="s1">&#39;testBucket&#39;</span><span class="o">)</span><span class="p">;</span>
bucket.save<span class="o">(</span>msg.payload<span class="o">)</span>
    .then<span class="o">(</span><span class="k">function</span><span class="o">(</span>robj<span class="o">)</span> <span class="o">{</span>
        node.send<span class="o">({</span>payload: robj<span class="o">})</span><span class="p">;</span>
    <span class="o">})</span>
    .catch <span class="o">(</span><span class="k">function</span><span class="o">(</span>error<span class="o">)</span> <span class="o">{</span>
        node.send<span class="o">({</span>payload: error<span class="o">})</span><span class="p">;</span>
    <span class="o">})</span><span class="p">;</span>
<span class="k">return</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="push">
<h3>3.1.6. Push 送信ノード<a class="headerlink" href="#push" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS の管理下にあるクライアント端末に <a class="reference external" href="../push/index.html">Push 送信</a> するノードです。
Push 送信ノード(push)の設定ダイアログを開き、以下を設定してください。</p>
<ul>
<li><p class="first">特定の「チャネル」向けに Push 送信したい場合は、 <strong>Channels</strong> 欄に配信先チャネル名を入力してください。</p>
<blockquote>
<div><p>例) channel1, channel2, ...</p>
</div></blockquote>
</li>
<li><p class="first">特定の「ユーザ/グループ」向けに Push 送信したい場合は、 <strong>Receivers</strong> 欄に受信者を入力してください。</p>
<blockquote>
<div><p>例) user_id, g:group1, g:group2, ...</p>
</div></blockquote>
</li>
<li><p class="first">Push 送信するメッセージ内容を <strong>Message</strong> 欄に入力してください。</p>
</li>
<li><p class="first"><strong>Push Type</strong> 欄で Push 送信方法を選択後、必要に応じて各送信方法の設定値を入力してください。</p>
</li>
</ul>
</div>
<div class="section" id="id31">
<h3>3.1.7. Push 受信ノード<a class="headerlink" href="#id31" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>NEC BaaS の SSE Push サーバから <a class="reference external" href="../push/index.html">Push 受信</a> するノードです。
Push 受信ノード(push)の設定ダイアログを開き、以下を設定してください。</p>
<ul>
<li><p class="first">特定の「チャネル」宛の Push を受信したい場合は、 <strong>Channels</strong> 欄にチャネル名を入力してください。 Channels の指定がない場合は、 Push 送信で Channels 指定されていない Push のみ受信します。</p>
<blockquote>
<div><p>例) channel1, channel2, ...</p>
</div></blockquote>
</li>
<li><p class="first">特定の「ユーザ/グループ」からのみの Push を受信したい場合は、 <strong>Senders</strong> 欄に送信者を入力してください。 Senders の指定がない場合は、 任意の送信者(&quot;g:anonymous&quot;)からの Push を受信します。</p>
<blockquote>
<div><p>例) user_id, g:group1, g:group2, ...</p>
</div></blockquote>
</li>
<li><p class="first">デバイスを一意に特定するデバイストークンを <strong>Device Token</strong> 欄に入力してください。</p>
<blockquote>
<div><p>例) UUID 等</p>
</div></blockquote>
</li>
</ul>
<p>Push ノードを受信待機状態とするには、上流から一度だけ入力を実行してください。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">入力時のメッセージで Push 受信の設定値を指定しない場合、 msg.payload の値は空の JSON オブジェクト {} にしてください。</p>
</div>
<p>正常に受信待機状態となった場合は、出力メッセージに以下のログが出力されます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>result: <span class="s2">&quot;ok&quot;</span>, payload: <span class="s2">&quot;SsePush: Connection established.&quot;</span> // Push 受信待機状態の成功時ログ
</pre></div>
</div>
<p>受信待機状態の間は、連続して Push データを受信できます。 Push データ受信時は出力メッセージに以下のログが出力されます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>result: <span class="s2">&quot;ok&quot;</span>, payload: <span class="o">{</span>type: <span class="s2">&quot;message&quot;</span>, data: <span class="s2">&quot;abcde&quot;</span>, ...<span class="o">}</span> // Push データ受信時のログ
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">注意</p>
<p class="last">Node-RED 上の各タブ画面内(各 Flow 内)で、同一の接続先( TenantID・AppID )を利用する複数の Push 受信ノードが存在する場合、 Push 受信待機状態にできるノードはいずれかの 1 ノードのみになります。
また、複数の Push 受信ノード間で受信待機状態とするノードを切り替える場合、受信待機状態となる前に一時的にエラーログ(401エラー等)が出力される場合があります。</p>
</div>
</div>
<div class="section" id="api-gw">
<h3>3.1.8. API-GW ノード<a class="headerlink" href="#api-gw" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ユーザが定義した REST API を使用して <a class="reference external" href="../cloudfunctions/index.html">Cloud Functions 機能</a> を呼び出すノードです。
API-GW ノードの設定ダイアログを開き、以下を設定してください。</p>
<ul class="simple">
<li>実行する API 情報として、 <strong>API Name, Method, Subpath, API Data</strong>　を入力してください。本パラメータに対応した API が実行されます。</li>
<li>API 実行のレスポンスをバイナリ(buffer)で受信する場合は、<strong>Response</strong> のチェックを有効にしてください。</li>
<li><strong>Headers</strong> 欄では API 実行要求時の Header を追加/削除できます。</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">ユーザが定義した REST API 情報は、 <a class="reference external" href="../cloudfunctions/setup.html">Nebula CLI ツール</a> を使用して事前に NEC BaaS サーバへ登録する必要があります。</p>
</div>
</div>
</div>
<div class="section" id="id33">
<h2>3.2. 補足事項<a class="headerlink" href="#id33" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id34">
<h3>3.2.1. NEC BaaS ライブラリの使用<a class="headerlink" href="#id34" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Function ノード内にスクリプトを実装する際、 NEC BaaS ライブラリを利用できます。
NEC BaaS ライブラリのインスタンスは、下記いずれかの方法で取得できます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>var <span class="nv">nb</span> <span class="o">=</span> flow.get<span class="o">(</span><span class="s1">&#39;Nebula&#39;</span><span class="o">)</span><span class="p">;</span>  // Flow context を利用
var <span class="nv">nb</span> <span class="o">=</span> nebula.get<span class="o">()</span><span class="p">;</span>        // 上記を簡易化したメソッド
</pre></div>
</div>
<p>NEC BaaS の各ノード間で NEC BaaS ライブラリのコンテキストを共有するため、 <a class="reference external" href="http://nodered.org/docs/creating-nodes/context">Flow context</a> を使用しています。 Flow context は同一タブ内にあるノード間で共有されます。</p>
<p>NEC BaaS ライブラリのインスタンスは、認証ノードまたは Function ノードの初期化時(initialize 有効時)に生成されます。</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="patterns.html" class="btn btn-neutral float-right" title="4. 利用パターン" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dev_setting.html" class="btn btn-neutral" title="2. 開発環境のセットアップ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2018, NEC Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-116465316-2"></script>
        <script type="text/javascript" src="_static/analytics.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>