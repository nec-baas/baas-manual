========
改訂履歴
========

モバイルバックエンド基盤の改訂履歴について以下に記載します。

なお、以前のバージョンからの移行方法については、サーバおよび各SDKのマニュアルに記載されている「マイグレーションガイド」を参照してください。
各マイグレーションガイドは以下の通りです。

* `サーバ利用手順書 : マイグレーションガイド <../server/migration.html>`_
* `Cloud Functions サーバ利用手順書 : マイグレーションガイド <../cloudfunctions-server/migration.html>`_
* `SSE Push サーバ利用手順書 : マイグレーションガイド <../ssepush-server/migration.html>`_

SDKの改訂履歴については、「デベロッパーマニュアル」⇒「SDKリリースノート」内の改訂履歴を参照してください。

.. attention::

  本履歴に表示しているバージョン番号はモバイルバックエンド基盤サーバの Suite バージョンであり、
  各サーバのバージョンとは必ずしも一致しません。
  バージョンの対応は、 `バージョン対応表 <../../version_info.html>`_ を参照してください。

ver 7.0.x → ver 7.5.0 での変更点
=================================

本バージョンより、サーバマニュアルとデベロッパーマニュアルを分割しました。


HTTP/2対応
----------------

HTTP/2プロトコルに対応しました。
大量のリクエストを行う場合等に、効率的に通信を行うことができます。
詳細は、 `HTTP/2使用手順 <../../../server/ja/server/extended/http2.html>`_ を参照して下さい。

Basic認証対応
----------------

REST API使用時に、`Basic認証 <../../../developer/ja/auth/local.html>`_  によるユーザ認証を行うことができます。

ユーザ管理
-------------

* ユーザバッチ処理(登録・更新・削除) API 追加

  - REST APIを使用し、管理者が一括してユーザ登録等を行うことができます。
    詳細は、`バッチオペレーションAPI <../../../developer/ja/rest-ref/user/batch.html>`_ を参照して下さい。

* ユーザ無効化 API 追加

  - REST APIやデベロッパーコンソールから、登録済みのユーザを無効化することができます。
    無効化したユーザは認証に失敗します。
    ユーザ登録、更新通知のメールに、ユーザの有効、無効を示す情報を追加しています。

JSONオブジェクトストレージ
------------------------------------

* JSONフィールド暗号化機能追加

  - 特定のフィールドを、暗号化してDBに保存することができます。詳細は、`データ暗号化 <../../../developer/ja/developer/functions/object_storage.html>`_ を参照して下さい。

* バッチ API に MongoDB トランザクション機能を追加

  - 複数のドキュメントをアトミックに更新することができます。
    使用にはMongoDB 4.0以上が必要です。詳細は、`バッチオペレーションAPI <../../../developer/ja/rest-ref/object/batch.html>`_ を参照して下さい。

* ACLレスバケット機能を追加(β版)

  - バケット単位でオブジェクトの ACL 制御を無効化することができます。 詳細は、`ACLレスバケット <../../../developer/ja/developer/functions/acl.html>`_ を参照して下さい。

ファイルストレージ
---------------------------

* 範囲指定ダウンロード機能追加

  - Rangeヘッダを使用したファイルの一部取得、更新有無による取得判定に対応しました。詳細は、`ファイルのダウンロードAPI <../../../developer/ja/rest-ref/file/download.html>`_ を参照して下さい。

管理 REST API 追加
--------------------------

テナント管理、アプリ管理を、REST APIから操作できます。詳細は、`管理API <../../../developer/ja/rest-admin-ref/index.html>`_ を参照して下さい。

REST API アクセスログ出力機能追加
-----------------------------------------

システムログとアクセスログを、別々に出力することができます。
詳細は、 `fluentd を利用したロギング <../../../server/ja/server/configure/fluentd.html>`_ を参照してください。

OpenJDK 11 対応
-----------------------

OpenJDK 11 に対応しました。

MongoDB Atlas 対応
-----------------------

MongoDB AtlasをバックエンドDBとして使用することができます。
詳細は、`MongoDB Atlas <../../../server/ja/server/extended/mongodb_atlas.html>`_ を参照して下さい。

イベント駆動追加
---------------------

モバイルバックエンド基盤内で発生したイベントを検知して、Cloud Functions機能を呼び出す、イベント駆動機能を追加しました。

詳細は、`イベント駆動開発ガイド <../../../developer/ja/events/index.html>`_ を参照してください。

Swagger UI
---------------------

Swagger UIをデベロッパーコンソールサーバに追加しました。
またAPIサーバは、OpenAPI Specification 3.0に準拠したREST API定義を出力できるようになりました。

REST API一覧の参照や、APIコールのテストを、ブラウザから簡単に行うことができます。

詳細は、デベロッパーガイドの「REST API ガイド」=>「REST APIの概要」を参照して下さい。

ver 7.0.3 → 7.0.4 での変更点
=============================

デベロッパーコンソールサーバ
----------------------------

以下の不具合修正を行いました。

* オブジェクト数が非常に多い場合、オブジェクト表示ページ総数がずれることがある
* IE11からファイルのアップロードが失敗する場合がある

ver 7.0.2 → ver 7.0.3 での変更点
=================================

APIサーバ・デベロッパーコンソールサーバ
----------------------------------------

以下の不具合修正を行いました。

* baas-adminコマンドでエクスポートしたテナントを正常にインポートできない
* コンソールのオブジェクト検索画面カラム操作時に表示不正になることがある

以下の機能追加を行いました。

* MongoDB サーバ指定に Connection String URI を利用可能

ver 7.0.0 → ver 7.0.2 での変更点
=================================

APIサーバ・デベロッパーコンソールサーバ
----------------------------------------

* APIGW(HTTP) リクエスト再送機能を追加
* ログ表示の逆順表示機能追加

Cloud Functions サーバ
----------------------

* サーバマネジャーのサービス起動設定に Java ヒープサイズ設定を追加

以下の不具合修正を行いました。

* Java Functionを連続呼び出しするとエラーになる場合がある

SSE Push サーバ
---------------

以下の不具合修正を行いました。

* クライアントから接続・切断を繰り返すとメモリリークが発生する

JavaScript SDK
---------------

以下の不具合修正を行いました。

* Proxy CONNECT 時の Host ヘッダ設定誤り修正 (tunnel -> tunnel-fork モジュールに変更)


ver 6.5.3 → ver 6.5.4 での変更点
=================================

デベロッパーコンソールサーバ
----------------------------

* ログ表示の逆順表示機能追加

Cloud Functions サーバ
----------------------

* サーバマネジャーのサービス起動設定に Java ヒープサイズ設定を追加
* 起動時にバージョン番号をログに出力する

以下の不具合修正を行いました。

* Java Functionを連続呼び出しするとエラーになる場合がある

SSE Push サーバ
---------------

以下の不具合修正を行いました。

* クライアントから接続・切断を繰り返すとメモリリークが発生する

JavaScript SDK
---------------

以下の不具合修正を行いました。

* Node.js で HttpRequest.setDefaultTimeout() の値がHTTPタイムアウトに設定されない
* Proxy CONNECT 時の Host ヘッダ設定誤り修正 (tunnel -> tunnel-fork モジュールに変更)

ver 6.5.x → ver 7.0.0 での変更点
=================================

APIサーバ・デベロッパーコンソールサーバ
----------------------------------------

* ライセンスキー認証を追加
* OpenID Connect認証 アカウントリンク対応を追加
* パスワードハッシュ方式を SHA-256 から BCrypt に変更
* コンソール機能強化

  - API統計情報画面強化(フィルタリング)
  - グループ編集機能強化: 所属ユーザ編集機能追加

* Tomcat で直接クライアント証明書認証する機能を追加

Windows Server 2016 対応
^^^^^^^^^^^^^^^^^^^^^^^^

APIサーバ・デベロッパーコンソールサーバ・SSE Push サーバを Windows Server 2016 に対応しました。

ただし、Cloud Functions サーバは対象外となります。

オブジェクトストレージ強化
^^^^^^^^^^^^^^^^^^^^^^^^^^^

MongoDB の Aggregation Framework、および Extended JSON 表記に対応しました。
詳細は「デベロッパーマニュアル」⇒「オブジェクトストレージ」をご参照ください。

これに伴い REST API 仕様を v7.0.2 に更新しました。

REST API の URL にテナント名が利用可能
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

REST API の URL にテナントIDではなくテナント名も使用できるようになりました。

::

    http://.../api/1/586da91204e80e089380c531

ではなく

::

    http://.../api/1/mytenant

のような URL でアクセス可能になります。
各 SDK では、テナントIDの代わりにテナント名が使用できます。


REST API 統計情報取得機能追加
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

MongoDBに保存している、API統計情報を取得するREST APIを追加しました。

API Gateway
^^^^^^^^^^^

Model に 以下のキーが使用できるようになりました。

* request.tenantId
* request.tenantName

SSE Push サーバ
----------------

クライアント登録時の安定性を改善しました。

なお、APIサーバ - SSE Push サーバ間のプロトコル変更に伴い、接続する
サーバ同士のバージョン関係について注意事項があります。
詳細はSSE Push サーバ利用手順書の「マイグレーションガイド」を参照してください。

JavaScript SDK
--------------

* Node.js パッケージ名を変更 ("nebula" ⇒ "@nec-baas/jssdk")
* npmjs.com にて JavaScript SDK パッケージを公開
* OpenID Connect認証 アカウントリンク対応 API追加
* Aggregation API追加
* Node.js SSE Push対応

.. attention::

   BREAKING CHANGES: Node.js で JavaScript SDK を使用している場合、
   SDK の組み込み手順および require の手順が変更となります。
   詳細は「JavaScript SDK ガイド」の「マイグレーションガイド」を参照ください。


Java / Android SDK
------------------

* ライブラリファイル名(JAR)変更
* API Gateway API追加
* Aggregation API追加

.NET SDK
--------

* API Gateway API追加
* Aggregation API追加

ver 6.5.2 → ver 6.5.3 での変更点
=================================

APIサーバ
---------

以下の不具合修正を行いました。

* API Gateway (HTTP) クエリストリングに使用できない文字がある
* AMQP RPC 応答処理(Cloud Functions応答など)が並列実行されない

デベロッパーコンソールサーバ
----------------------------

以下の不具合修正を行いました。

* ユーザ検索後のページネーションが動作しない

Cloud Functions サーバ
----------------------

サーバマネージャに以下の機能追加を行いました。

* Fluentd 使用していないときでも、Function ログを記録できるようにした(Server Manager ログに合わせて記録)

サーバマネージャ / Java ロジックサーバに以下の不具合修正を行いました。

* クライアントからカスタムAPI呼び出しを連続して繰り返し実行するとエラーとなる

SSE Push サーバ
---------------

* 脆弱性修正のため、Jackson Databind を 2.9.4 に更新しました。

ver 6.5.1 → ver 6.5.2 での変更点
=================================

APIサーバ
---------

以下の不具合修正を行いました。サーババージョンは v6.5.2 となります。

* SSE Push 送信先が 4096 個を超えると送信エラーになる
* オブジェクトストレージ: 部分更新で一部の演算子を使うと、update権限のみでACLを変更できてしまう
* ファイルストレージ: ファイル名に日本語が含まれるときに、Content-Disposition ヘッダのファイル名が文字化けする
* ファイルストレージ: メモリ不足が原因で、AWS S3 に対する大容量ファイルアップロードが失敗することがある

また、脆弱性対応のため内蔵する OSS を以下の通りアップデートしました。

* Jackson 2.9.4
* Spring Framework 4.3.14
* Spring Security 4.2.4

Cloud Functions サーバ
----------------------

Java ロジックサーバ / Node ロジックサーバに以下の不具合修正を行いました。
サーババージョンは v6.5.1 となります。

* Content-Type にパラメータ (;charset=utf-8など)が付与されているとエラーになる

JavaScript SDK
---------------

以下の不具合修正を行いました。バージョンは v6.5.2 となります。

* CSPヘッダの設定次第で、SDK のロードがエラーになる場合がある

ver 6.5.0 → ver 6.5.1 での変更点
=================================

APIサーバ
---------

* MongoDB 最大コネクション数のデフォルト値を 2000 から 200 に変更
* テナント名に使用できる文字制約を追加 (先頭は英数字のみ、24文字hex文字列使用不可)
* サーバログ改善: (ログイン成功時にセッショントークンの一部を出力)

JavaScript SDK
---------------

* TypeScript 対応を強化しました
* Node.js から JavaScript SDK の require 手順が変更となります

.. attention::

   BREAKING CHANGES: Node.js で JavaScript SDK を使用している場合、require の手順が変更となります。
   (require('nebula') を require('nebula').Nebula へ置換する必要があります)。
   詳細は「JavaScript SDK ガイド」の「マイグレーションガイド」 を参照ください。
